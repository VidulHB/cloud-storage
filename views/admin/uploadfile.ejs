<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ACPASD | Admin | Upload File</title>
  <link rel="shortcut icon" href="https://acpasd.cyclic.app/img/main_icon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://kit.fontawesome.com/6324e69e50.js" crossorigin="anonymous"></script>
  <script src="https://js.upload.io/upload-js/v2"></script>
  <link rel="stylesheet" href="https://acpasd.cyclic.app/styles.css">
  <style>
  .modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #333;
  opacity: 0.9;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 30px;
  border-radius: 20px;
  width: 350px; /* Could be more or less, depending on screen size */
  height: 85px;
}
.modal-content h1{
  margin-bottom:10px;
}
/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

  /* Modal Header */
.modal-header {
  padding: 2px 16px;
  color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
  padding: 2px 16px;
  color: white;
}

/* Add Animation */
@-webkit-keyframes slideIn {
  from {bottom: -300px; opacity: 0} 
  to {bottom: 0; opacity: 1}
}

@keyframes slideIn {
  from {bottom: -300px; opacity: 0}
  to {bottom: 0; opacity: 1}
}

@-webkit-keyframes fadeIn {
  from {opacity: 0} 
  to {opacity: 1}
}

@keyframes fadeIn {
  from {opacity: 0} 
  to {opacity: 1}
}
</style>
</head>

  <body onload="load()">
    <div class="news_form">
      <h2>Upload Files Here</h2>
      <form class="admin_news" action="/api/addnews" method="post" enctype="multipart/form-data">
        <input type="file" id="fileInput" name="fileInput" required multiple>
      </form>
    </div>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <h2 style="margin-top: -15px;">File Upload Progress</h2>
        <div class="progress-container" id="progressCon">
          <p class="progress-p" id="progress">0%</p>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://apis.google.com/js/api.js"></script>

    <script>
      const modal = document.getElementById("myModal");
      const fileInput = document.getElementById('fileInput');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progress');
      const progressCon = document.getElementById('progressCon');

      // fileInput.addEventListener('change', function () {
      //   const files = fileInput.files;
      //   if (files.length > 0) {
      //     const formData = new FormData();
      //     for (let i = 0; i < files.length; i++) {
      //       formData.append('files[]', files[i]); // Use 'files[]' to indicate an array of files.
      //     }

      //     const xhr = new XMLHttpRequest();
      //     xhr.open('POST', '/Upload', true);

      //     xhr.upload.addEventListener('progress', (e) => {
      //       if (e.lengthComputable) {
      //         const percentage = Math.round((e.loaded / e.total) * 100);
      //         modal.style.display = "block";
      //         progressBar.style.width = `${percentage}%`;
      //         if (percentage === 100) {
      //           // progressText.innerHTML = `Saving... This Might Take Some Time (Depending On The File Size)`;
      //           progressBar.style.display = "none"
      //           progressText.innerHTML = ``
      //           progressText.innerHTML = `Done... You Can Click X Button To Exit This Pop-Up`
      //         } else {
      //           progressText.innerHTML = `${percentage}%`;
      //         }
      //       }
      //     });

      //     xhr.onload = function () {
      //       if (xhr.status === 200) {
      //         progressBar.style.display = "none"
      //         progressText.innerHTML = ``
      //         progressText.innerHTML = `Done... You Can Click X Button To Exit This Pop-Up`
      //       } else {
      //         console.error('Error uploading files.');
      //       }
      //     };
      //     formData.append('id', `<%-FolderID%>`)
      //     xhr.send(formData);
      //   }
      // });
      gapi.load('client:auth2', initClient);

function initClient() {
  gapi.client.init({
    apiKey: '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',
    clientId: '575885196733-42k59toflhicu532gdjjmd7kf7501jok.apps.googleusercontent.com',
    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
    scope: 'https://www.googleapis.com/auth/drive.file',
  }).then(function () {
    // Handle the authorization
  });
}
function load() {
  gapi.auth2.getAuthInstance().signIn();
}
function uploadFiles() {
  const files = document.getElementById('fileInput').files;
  for (const file of files) {
    uploadFile(file);
  }
}

const currentUrl = window.location.href;
const urlParams = new URLSearchParams(currentUrl);
const parentFolderId = urlParams.get('id');

function uploadFile(file, parentFolderId) {
  const metadata = {
    name: file.name,
    mimeType: file.type,
    parents: [parentFolderId], // Add the parent folder ID
  };

  const form = new FormData();
  form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
  form.append('file', file);

  gapi.client.drive.files.create({
    resource: metadata,
    media: {
      mimeType: file.type,
      body: form,
    },
  }).then(function (response) {
    console.log('File ID:', response.result.id);
  });
}




      fileInput.addEventListener('change', function () {
        
      });
    </script>
  </body>
  <script src="https://acpasd.cyclic.app/script.js"></script>
  </html>